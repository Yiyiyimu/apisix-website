(window.webpackJsonp=window.webpackJsonp||[]).push([[185],{253:function(e,t,a){"use strict";a.r(t),a.d(t,"frontMatter",(function(){return i})),a.d(t,"metadata",(function(){return b})),a.d(t,"toc",(function(){return c})),a.d(t,"default",(function(){return p}));var n=a(3),r=a(8),l=(a(0),a(265)),i={title:"ApisixUpstream Reference"},b={unversionedId:"references/apisix_upstream",id:"references/apisix_upstream",isDocsHomePage:!1,title:"ApisixUpstream Reference",description:"\x3c!--",source:"@site/docs/apisix-ingress-controller/references/apisix_upstream.md",slug:"/references/apisix_upstream",permalink:"/zh/docs/ingress-controller/references/apisix_upstream",editUrl:"https://github.com/apache/apisix-ingress-controller/edit/master/docs/zh/latest/references/apisix_upstream.md",version:"current",sidebar:"docs",previous:{title:"ApisixRoute/v2alpha1 Reference",permalink:"/zh/docs/ingress-controller/references/apisix_route_v2alpha1"},next:{title:"ApisixTls Reference",permalink:"/zh/docs/ingress-controller/references/apisix_tls"}},c=[],d={toc:c};function p(e){var t=e.components,a=Object(r.a)(e,["components"]);return Object(l.b)("wrapper",Object(n.a)({},d,a,{components:t,mdxType:"MDXLayout"}),Object(l.b)("table",null,Object(l.b)("thead",{parentName:"table"},Object(l.b)("tr",{parentName:"thead"},Object(l.b)("th",{parentName:"tr",align:null},"Field"),Object(l.b)("th",{parentName:"tr",align:null},"Type"),Object(l.b)("th",{parentName:"tr",align:null},"Description"))),Object(l.b)("tbody",{parentName:"table"},Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",{parentName:"tr",align:null},"scheme"),Object(l.b)("td",{parentName:"tr",align:null},"string"),Object(l.b)("td",{parentName:"tr",align:null},"The protocol used to talk to the Service, can be ",Object(l.b)("inlineCode",{parentName:"td"},"http"),", ",Object(l.b)("inlineCode",{parentName:"td"},"grpc"),", default is ",Object(l.b)("inlineCode",{parentName:"td"},"http"),".")),Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",{parentName:"tr",align:null},"loadbalancer"),Object(l.b)("td",{parentName:"tr",align:null},"object"),Object(l.b)("td",{parentName:"tr",align:null},"The load balancing algorithm of this upstream service")),Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",{parentName:"tr",align:null},"loadbalancer.type"),Object(l.b)("td",{parentName:"tr",align:null},"string"),Object(l.b)("td",{parentName:"tr",align:null},"The load balancing type, can be ",Object(l.b)("inlineCode",{parentName:"td"},"roundrobin"),", ",Object(l.b)("inlineCode",{parentName:"td"},"ewma"),", ",Object(l.b)("inlineCode",{parentName:"td"},"least_conn"),", ",Object(l.b)("inlineCode",{parentName:"td"},"chash"),", default is ",Object(l.b)("inlineCode",{parentName:"td"},"roundrobin"),".")),Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",{parentName:"tr",align:null},"loadbalancer.hashOn"),Object(l.b)("td",{parentName:"tr",align:null},"string"),Object(l.b)("td",{parentName:"tr",align:null},"The hash value source scope, only take effects if the ",Object(l.b)("inlineCode",{parentName:"td"},"chash")," algorithm is in use. Values can ",Object(l.b)("inlineCode",{parentName:"td"},"vars"),", ",Object(l.b)("inlineCode",{parentName:"td"},"header"),", ",Object(l.b)("inlineCode",{parentName:"td"},"vars_combinations"),", ",Object(l.b)("inlineCode",{parentName:"td"},"cookie")," and ",Object(l.b)("inlineCode",{parentName:"td"},"consumers"),", default is ",Object(l.b)("inlineCode",{parentName:"td"},"vars"),".")),Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",{parentName:"tr",align:null},"loadbalancer.key"),Object(l.b)("td",{parentName:"tr",align:null},"string"),Object(l.b)("td",{parentName:"tr",align:null},"The hash key, only in valid if the ",Object(l.b)("inlineCode",{parentName:"td"},"chash")," algorithm is used.")),Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",{parentName:"tr",align:null},"retries"),Object(l.b)("td",{parentName:"tr",align:null},"int"),Object(l.b)("td",{parentName:"tr",align:null},"The retry count.")),Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",{parentName:"tr",align:null},"timeout"),Object(l.b)("td",{parentName:"tr",align:null},"object"),Object(l.b)("td",{parentName:"tr",align:null},"The timeout settings.")),Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",{parentName:"tr",align:null},"timeout.connect"),Object(l.b)("td",{parentName:"tr",align:null},'time duration in the form "72h3m0.5s"'),Object(l.b)("td",{parentName:"tr",align:null},"The connect timeout.")),Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",{parentName:"tr",align:null},"timeout.read"),Object(l.b)("td",{parentName:"tr",align:null},'time duration in the form "72h3m0.5s"'),Object(l.b)("td",{parentName:"tr",align:null},"The read timeout.")),Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",{parentName:"tr",align:null},"timeout.send"),Object(l.b)("td",{parentName:"tr",align:null},'time duration in the form "72h3m0.5s"'),Object(l.b)("td",{parentName:"tr",align:null},"The send timeout.")),Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",{parentName:"tr",align:null},"healthCheck"),Object(l.b)("td",{parentName:"tr",align:null},"object"),Object(l.b)("td",{parentName:"tr",align:null},"The health check parameters, see ",Object(l.b)("a",{parentName:"td",href:"https://github.com/apache/apisix/blob/master/doc/health-check.md"},"Health Check")," for more details.")),Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",{parentName:"tr",align:null},"healthCheck.active"),Object(l.b)("td",{parentName:"tr",align:null},"object"),Object(l.b)("td",{parentName:"tr",align:null},"active health check configuration, which is a mandatory field.")),Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",{parentName:"tr",align:null},"healthCheck.active.type"),Object(l.b)("td",{parentName:"tr",align:null},"string"),Object(l.b)("td",{parentName:"tr",align:null},"health check type, can be ",Object(l.b)("inlineCode",{parentName:"td"},"http"),", ",Object(l.b)("inlineCode",{parentName:"td"},"https")," and ",Object(l.b)("inlineCode",{parentName:"td"},"tcp"),", default is ",Object(l.b)("inlineCode",{parentName:"td"},"http"),".")),Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",{parentName:"tr",align:null},"healthCheck.active.timeout"),Object(l.b)("td",{parentName:"tr",align:null},'time duration in the form "72h3m0.5s"'),Object(l.b)("td",{parentName:"tr",align:null},"the timeout settings for the probe, default is ",Object(l.b)("inlineCode",{parentName:"td"},"1s"),".")),Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",{parentName:"tr",align:null},"healthCheck.active.concurrency"),Object(l.b)("td",{parentName:"tr",align:null},"int"),Object(l.b)("td",{parentName:"tr",align:null},"how many probes can be sent simultaneously, default is ",Object(l.b)("inlineCode",{parentName:"td"},"10"),".")),Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",{parentName:"tr",align:null},"healthCheck.active.host"),Object(l.b)("td",{parentName:"tr",align:null},"string"),Object(l.b)("td",{parentName:"tr",align:null},"host header in http probe request, only in valid if the active health check type is ",Object(l.b)("inlineCode",{parentName:"td"},"http")," or ",Object(l.b)("inlineCode",{parentName:"td"},"https"),".")),Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",{parentName:"tr",align:null},"healthCheck.active.port"),Object(l.b)("td",{parentName:"tr",align:null},"int"),Object(l.b)("td",{parentName:"tr",align:null},"target port to receive probes, it's necessary to specify this field if the health check service exposes by different port, note the port value here is the container port, not the service port.")),Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",{parentName:"tr",align:null},"healthCheck.active.httpPath"),Object(l.b)("td",{parentName:"tr",align:null},"string"),Object(l.b)("td",{parentName:"tr",align:null},"the HTTP URI path in http probe, only in valid if the active health check type is ",Object(l.b)("inlineCode",{parentName:"td"},"http")," or ",Object(l.b)("inlineCode",{parentName:"td"},"https"),".")),Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",{parentName:"tr",align:null},"healthCheck.active.strictTLS"),Object(l.b)("td",{parentName:"tr",align:null},"boolean"),Object(l.b)("td",{parentName:"tr",align:null},"whether to use the strict mode when use TLS, only in valid if the active health check type is ",Object(l.b)("inlineCode",{parentName:"td"},"https"),", default is ",Object(l.b)("inlineCode",{parentName:"td"},"true"),".")),Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",{parentName:"tr",align:null},"healthCheck.active.requestHeaders"),Object(l.b)("td",{parentName:"tr",align:null},"array of string"),Object(l.b)("td",{parentName:"tr",align:null},"Extra HTTP requests carried in the http probe, only in valid if the active health check type is ",Object(l.b)("inlineCode",{parentName:"td"},"http")," or ",Object(l.b)("inlineCode",{parentName:"td"},"https"),".")),Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",{parentName:"tr",align:null},"healthCheck.active.healthy"),Object(l.b)("td",{parentName:"tr",align:null},"object"),Object(l.b)("td",{parentName:"tr",align:null},"The conditions to judge an endpoint is healthy.")),Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",{parentName:"tr",align:null},"healthCheck.active.healthy.successes"),Object(l.b)("td",{parentName:"tr",align:null},"int"),Object(l.b)("td",{parentName:"tr",align:null},"The number of consecutive requests needed to set an endpoint as healthy, default is ",Object(l.b)("inlineCode",{parentName:"td"},"2"),".")),Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",{parentName:"tr",align:null},"healthCheck.active.healthy.httpCodes"),Object(l.b)("td",{parentName:"tr",align:null},"array of integer"),Object(l.b)("td",{parentName:"tr",align:null},"Good status codes list to check whether a probe is successful, only in valid if the active health check type is ",Object(l.b)("inlineCode",{parentName:"td"},"http")," or ",Object(l.b)("inlineCode",{parentName:"td"},"https"),", default is ",Object(l.b)("inlineCode",{parentName:"td"},"[200, 302]"),".")),Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",{parentName:"tr",align:null},"healthCheck.active.healthy.interval"),Object(l.b)("td",{parentName:"tr",align:null},'time duration in the form "72h3m0.5s"'),Object(l.b)("td",{parentName:"tr",align:null},"The probes sent interval (for healthy endpoints).")),Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",{parentName:"tr",align:null},"healthCheck.active.unhealthy"),Object(l.b)("td",{parentName:"tr",align:null},"object"),Object(l.b)("td",{parentName:"tr",align:null},"The conditions to judge an endpoint is unhealthy.")),Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",{parentName:"tr",align:null},"healthCheck.active.unhealthy.httpFailures"),Object(l.b)("td",{parentName:"tr",align:null},"int"),Object(l.b)("td",{parentName:"tr",align:null},"The number of consecutive http requests needed to set an endpoint as unhealthy, only in valid if the active health check type is ",Object(l.b)("inlineCode",{parentName:"td"},"http")," or ",Object(l.b)("inlineCode",{parentName:"td"},"https"),", default is ",Object(l.b)("inlineCode",{parentName:"td"},"5"),".")),Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",{parentName:"tr",align:null},"healthCheck.active.unhealthy.tcpFailures"),Object(l.b)("td",{parentName:"tr",align:null},"int"),Object(l.b)("td",{parentName:"tr",align:null},"The number of consecutive tcp connections needed to set an endpoint as unhealthy, only in valid if the active health check type is ",Object(l.b)("inlineCode",{parentName:"td"},"tcp"),", default is ",Object(l.b)("inlineCode",{parentName:"td"},"2"),".")),Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",{parentName:"tr",align:null},"healthCheck.active.unhealthy.httpCodes"),Object(l.b)("td",{parentName:"tr",align:null},"array of integer"),Object(l.b)("td",{parentName:"tr",align:null},"Bad status codes list to check whether a probe is failed, only in valid if the active health check type is ",Object(l.b)("inlineCode",{parentName:"td"},"http")," or ",Object(l.b)("inlineCode",{parentName:"td"},"https"),", default is ",Object(l.b)("inlineCode",{parentName:"td"},"[429, 404, 500, 501, 502, 503, 504, 505]"),".")),Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",{parentName:"tr",align:null},"healthCheck.active.unhealthy.interval"),Object(l.b)("td",{parentName:"tr",align:null},'time duration in the form "72h3m0.5s"'),Object(l.b)("td",{parentName:"tr",align:null},"The probes sent interval (for unhealthy endpoints).")),Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",{parentName:"tr",align:null},"healthCheck.passive"),Object(l.b)("td",{parentName:"tr",align:null},"object"),Object(l.b)("td",{parentName:"tr",align:null},"passive health check configuration, which is an optional field.")),Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",{parentName:"tr",align:null},"healthCheck.passive.type"),Object(l.b)("td",{parentName:"tr",align:null},"string"),Object(l.b)("td",{parentName:"tr",align:null},"health check type, can be ",Object(l.b)("inlineCode",{parentName:"td"},"http"),", ",Object(l.b)("inlineCode",{parentName:"td"},"https")," and ",Object(l.b)("inlineCode",{parentName:"td"},"tcp"),", default is ",Object(l.b)("inlineCode",{parentName:"td"},"http"),".")),Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",{parentName:"tr",align:null},"healthCheck.passive.healthy"),Object(l.b)("td",{parentName:"tr",align:null},"object"),Object(l.b)("td",{parentName:"tr",align:null},"The conditions to judge an endpoint is healthy.")),Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",{parentName:"tr",align:null},"healthCheck.passive.healthy.successes"),Object(l.b)("td",{parentName:"tr",align:null},"int"),Object(l.b)("td",{parentName:"tr",align:null},"The number of consecutive requests needed to set an endpoint as healthy, default is ",Object(l.b)("inlineCode",{parentName:"td"},"5"),".")),Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",{parentName:"tr",align:null},"healthCheck.passive.healthy.httpCodes"),Object(l.b)("td",{parentName:"tr",align:null},"array of integer"),Object(l.b)("td",{parentName:"tr",align:null},"Good status codes list to check whether a probe is successful, only in valid if the active health check type is ",Object(l.b)("inlineCode",{parentName:"td"},"http")," or ",Object(l.b)("inlineCode",{parentName:"td"},"https"),", default is ",Object(l.b)("inlineCode",{parentName:"td"},"[200, 201, 202, 203, 204, 205, 206, 207, 208, 226, 300, 301, 302, 303, 304, 305, 306, 307, 308]"),".")),Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",{parentName:"tr",align:null},"healthCheck.passive.unhealthy"),Object(l.b)("td",{parentName:"tr",align:null},"object"),Object(l.b)("td",{parentName:"tr",align:null},"The conditions to judge an endpoint is unhealthy.")),Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",{parentName:"tr",align:null},"healthCheck.passive.unhealthy.httpFailures"),Object(l.b)("td",{parentName:"tr",align:null},"int"),Object(l.b)("td",{parentName:"tr",align:null},"The number of consecutive http requests needed to set an endpoint as unhealthy, only in valid if the active health check type is ",Object(l.b)("inlineCode",{parentName:"td"},"http")," or ",Object(l.b)("inlineCode",{parentName:"td"},"https"),", default is ",Object(l.b)("inlineCode",{parentName:"td"},"5"),".")),Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",{parentName:"tr",align:null},"healthCheck.passive.unhealthy.tcpFailures"),Object(l.b)("td",{parentName:"tr",align:null},"int"),Object(l.b)("td",{parentName:"tr",align:null},"The number of consecutive tcp connections needed to set an endpoint as unhealthy, only in valid if the active health check type is ",Object(l.b)("inlineCode",{parentName:"td"},"tcp"),", default is ",Object(l.b)("inlineCode",{parentName:"td"},"2"),".")),Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",{parentName:"tr",align:null},"healthCheck.passive.unhealthy.httpCodes"),Object(l.b)("td",{parentName:"tr",align:null},"array of integer"),Object(l.b)("td",{parentName:"tr",align:null},"Bad status codes list to check whether a probe is failed, only in valid if the active health check type is ",Object(l.b)("inlineCode",{parentName:"td"},"http")," or ",Object(l.b)("inlineCode",{parentName:"td"},"https"),", default is ",Object(l.b)("inlineCode",{parentName:"td"},"[429, 404, 500, 501, 502, 503, 504, 505]"),".")),Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",{parentName:"tr",align:null},"portLevelSettings"),Object(l.b)("td",{parentName:"tr",align:null},"array"),Object(l.b)("td",{parentName:"tr",align:null},"Settings for each individual port.")),Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",{parentName:"tr",align:null},"portLevelSettings.port"),Object(l.b)("td",{parentName:"tr",align:null},"int"),Object(l.b)("td",{parentName:"tr",align:null},"The port number defined in the Kubernetes Service, must be a valid port.")),Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",{parentName:"tr",align:null},"portLevelSettings.scheme"),Object(l.b)("td",{parentName:"tr",align:null},"string"),Object(l.b)("td",{parentName:"tr",align:null},"same as ",Object(l.b)("inlineCode",{parentName:"td"},"scheme")," but takes higher precedence.")),Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",{parentName:"tr",align:null},"portLevelSettings.loadbalancer"),Object(l.b)("td",{parentName:"tr",align:null},"object"),Object(l.b)("td",{parentName:"tr",align:null},"same as ",Object(l.b)("inlineCode",{parentName:"td"},"loadbalancer")," but takes higher precedence.")),Object(l.b)("tr",{parentName:"tbody"},Object(l.b)("td",{parentName:"tr",align:null},"portLevelSettings.healthCheck"),Object(l.b)("td",{parentName:"tr",align:null},"object"),Object(l.b)("td",{parentName:"tr",align:null},"same as ",Object(l.b)("inlineCode",{parentName:"td"},"healthCheck")," but takes higher precedence.")))))}p.isMDXComponent=!0},265:function(e,t,a){"use strict";a.d(t,"a",(function(){return o})),a.d(t,"b",(function(){return s}));var n=a(0),r=a.n(n);function l(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function b(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){l(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function c(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},l=Object.keys(e);for(n=0;n<l.length;n++)a=l[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(n=0;n<l.length;n++)a=l[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var d=r.a.createContext({}),p=function(e){var t=r.a.useContext(d),a=t;return e&&(a="function"==typeof e?e(t):b(b({},t),e)),a},o=function(e){var t=p(e.components);return r.a.createElement(d.Provider,{value:t},e.children)},h={inlineCode:"code",wrapper:function(e){var t=e.children;return r.a.createElement(r.a.Fragment,{},t)}},m=r.a.forwardRef((function(e,t){var a=e.components,n=e.mdxType,l=e.originalType,i=e.parentName,d=c(e,["components","mdxType","originalType","parentName"]),o=p(a),m=n,s=o["".concat(i,".").concat(m)]||o[m]||h[m]||l;return a?r.a.createElement(s,b(b({ref:t},d),{},{components:a})):r.a.createElement(s,b({ref:t},d))}));function s(e,t){var a=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var l=a.length,i=new Array(l);i[0]=m;var b={};for(var c in t)hasOwnProperty.call(t,c)&&(b[c]=t[c]);b.originalType=e,b.mdxType="string"==typeof e?e:n,i[1]=b;for(var d=2;d<l;d++)i[d]=a[d];return r.a.createElement.apply(null,i)}return r.a.createElement.apply(null,a)}m.displayName="MDXCreateElement"}}]);