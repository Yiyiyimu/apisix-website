(window.webpackJsonp=window.webpackJsonp||[]).push([[66],{134:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return c})),n.d(t,"metadata",(function(){return i})),n.d(t,"toc",(function(){return l})),n.d(t,"default",(function(){return p}));var r=n(3),a=n(7),o=(n(0),n(255)),c={title:"Get Front-End Test Coverage with Cypress",author:"Yi Sun",authorURL:"https://github.com/LiteSun",authorImageURL:"https://avatars.githubusercontent.com/u/31329157?s=400&u=e81b4bb4db2be162c1fcac6d188f5b0f82f71920&v=4"},i={permalink:"/zh/blog/2021/03/02/get-front-end-test-coverage-with-cypress",source:"@site/blog/2021-03-02-get-front-end-test-coverage-with-cypress.md",description:"@LiteSun, Apache APISIX Committer from Shenzhen Zhiliu Technology Co.",date:"2021-03-02T00:00:00.000Z",tags:[],title:"Get Front-End Test Coverage with Cypress",readingTime:2.225,truncated:!0,prevItem:{title:"Traffic Split in Apache APISIX Ingress Controller",permalink:"/zh/blog/2021/03/27/traffic-split-in-apache-apisix-ingress-controller"},nextItem:{title:"Install Apache APISIX from Helm Charts",permalink:"/zh/blog/2021/02/26/install-apache-apisix-from-helm-charts"}},l=[{value:"Background",id:"background",children:[]},{value:"What is code coverage?",id:"what-is-code-coverage",children:[]},{value:"Installation Dependencies &amp; Configuration",id:"installation-dependencies--configuration",children:[]},{value:"Summary",id:"summary",children:[]}],s={toc:l};function p(e){var t=e.components,n=Object(a.a)(e,["components"]);return Object(o.b)("wrapper",Object(r.a)({},s,n,{components:t,mdxType:"MDXLayout"}),Object(o.b)("blockquote",null,Object(o.b)("p",{parentName:"blockquote"},Object(o.b)("a",{parentName:"p",href:"https://github.com/LiteSun"},"@LiteSun"),", Apache APISIX Committer from ",Object(o.b)("a",{parentName:"p",href:"https://www.apiseven.com/"},"Shenzhen Zhiliu Technology Co."))),Object(o.b)("blockquote",null,Object(o.b)("p",{parentName:"blockquote"},"Source:"),Object(o.b)("ul",{parentName:"blockquote"},Object(o.b)("li",{parentName:"ul"},Object(o.b)("a",{parentName:"li",href:"https://github.com/apache/apisix"},"https://github.com/apache/apisix")),Object(o.b)("li",{parentName:"ul"},Object(o.b)("a",{parentName:"li",href:"https://github.com/apache/apisix-dashboard"},"https://github.com/apache/apisix-dashboard")))),Object(o.b)("h2",{id:"background"},"Background"),Object(o.b)("p",null,"In the article ",Object(o.b)("a",{parentName:"p",href:"/blog/2021/02/08/stable-product-delivery-with-cypress"},'"Stable Product Delivery with Cypress"'),", we discussed why we chose Cypress as our E2E testing framework. After spending nearly two months refining the test cases, we needed test coverage to quantify whether the test coverage was sufficient.This article will describe how to get APISIX Dashboard front-end E2E coverage using Cypress."),Object(o.b)("h2",{id:"what-is-code-coverage"},"What is code coverage?"),Object(o.b)("p",null,"Code coverage is a metric in software testing that describes the proportion and extent to which the source code in a program is tested, and the resulting proportion is called code coverage. Test code coverage reflects the health of the code to a certain extent."),Object(o.b)("h2",{id:"installation-dependencies--configuration"},"Installation Dependencies & Configuration"),Object(o.b)("p",null,"To collect test coverage data, we need to put some probes in the original business code for Cypress to collect the data."),Object(o.b)("p",null,"Cypress officially recommends two approaches, the first is to generate a temporary directory via ",Object(o.b)("inlineCode",{parentName:"p"},"nyc")," and run the code that has been written to the probe to collect test coverage data. The second way is to do the code conversion in real time through the code conversion pipeline, which eliminates the hassle of temporary folders and makes collecting test coverage data relatively refreshing. We choose the second way to collect front-end E2E coverage."),Object(o.b)("ol",null,Object(o.b)("li",{parentName:"ol"},"Installing Dependencies")),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-shell"},"yarn add  babel-plugin-istanbul --dev\n")),Object(o.b)("ol",{start:2},Object(o.b)("li",{parentName:"ol"},"Install the cypress plug-in")),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-shell"},"yarn add  @cypress/code-coverage --dev\n")),Object(o.b)("ol",{start:3},Object(o.b)("li",{parentName:"ol"},"Configuring babel")),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-ts"},'// web/config/config.ts\nextraBabelPlugins: [\n    [\'babel-plugin-istanbul\',  {\n      "exclude": ["**/.umi", "**/locales"]\n    }],\n  ],\n')),Object(o.b)("ol",{start:4},Object(o.b)("li",{parentName:"ol"},"Configuring Cypress code coverage plugin")),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-javaScript"},"// web/cypress/plugins/index.js\nmodule.exports = (on, config) => {\n  require('@cypress/code-coverage/task')(on, config);\n  return config;\n};\n")),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-javaScript"},"// web/cypress/support/index.js\nimport '@cypress/code-coverage/support';\n")),Object(o.b)("ol",{start:5},Object(o.b)("li",{parentName:"ol"},"Get Test Coverage")),Object(o.b)("p",null,"After the configuration is done, we need to run the test case. After the test case is run, Cypress will generate ",Object(o.b)("inlineCode",{parentName:"p"},"coverage")," and ",Object(o.b)("inlineCode",{parentName:"p"},".nyc_output")," folders, which contain the test coverage reports."),Object(o.b)("p",null,Object(o.b)("img",{parentName:"p",src:"https://lh4.googleusercontent.com/o-tyQagmCjprpNkuTjMFLaALZKtW4pyC9nj-GcPx4MM3xK0zrMED9Nndk5ZmZkZsQ5SIJPEovcrHyjWP2YXtEcYYDpLL49aV_97N83doTkOuMXlFsVjGu53A9FdlxOCr6i3aIDTA",alt:"1.png"})),Object(o.b)("p",null,"The test coverage information will appear in the console after executing the following command."),Object(o.b)("pre",null,Object(o.b)("code",{parentName:"pre",className:"language-shell"},"npx nyc report --reporter=text-summary\n")),Object(o.b)("p",null,Object(o.b)("img",{parentName:"p",src:"https://lh4.googleusercontent.com/n0CON1WF64wEnh3IYEc3wwwOJ2Ft_WmMLfkhOPKIKxoW0NP6Eq8VplJ87EepL5zIWOeyfJhlDmhc3ImE0ivgRlXWe1RuW2x7vL_JEri7Mz6b3tOY0it8bVvUe83CAHNgeoyXZnsy",alt:"2.png"})),Object(o.b)("p",null,"Under the coverage directory, a more detailed report page will be available, as shown here."),Object(o.b)("p",null,Object(o.b)("img",{parentName:"p",src:"https://lh4.googleusercontent.com/skjR9YUcbmeytfoYnR0it7Vfc7mheCJDt7PSUsp549IbOdfqskTrIOqUXw01e0fnuNwpGoo3GtqAER3eQjNoTIdmU7HY6hc_sZ5NYc3h-MyxqmVz_NaC3AM-J4rWJFy-9IoTWjpn",alt:"3.png"})),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},Object(o.b)("p",{parentName:"li"},"Statements indicates whether each statement was executed")),Object(o.b)("li",{parentName:"ul"},Object(o.b)("p",{parentName:"li"},"Branchs indicates whether each if block was executed")),Object(o.b)("li",{parentName:"ul"},Object(o.b)("p",{parentName:"li"},"Functions indicates whether each function is called")),Object(o.b)("li",{parentName:"ul"},Object(o.b)("p",{parentName:"li"},"Lines indicates whether each line was executed"))),Object(o.b)("h2",{id:"summary"},"Summary"),Object(o.b)("p",null,"The test coverage rate reflects the quality of the project to a certain extent. At present, APISIX Dashboard front-end E2E coverage rate has reached 71.57%. We will continue to work with the community to enhance the test coverage rate and provide more reliable and stable products for users."))}p.isMDXComponent=!0},255:function(e,t,n){"use strict";n.d(t,"a",(function(){return b})),n.d(t,"b",(function(){return d}));var r=n(0),a=n.n(r);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function c(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?c(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var s=a.a.createContext({}),p=function(e){var t=a.a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},b=function(e){var t=p(e.components);return a.a.createElement(s.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.a.createElement(a.a.Fragment,{},t)}},h=a.a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,c=e.parentName,s=l(e,["components","mdxType","originalType","parentName"]),b=p(n),h=r,d=b["".concat(c,".").concat(h)]||b[h]||u[h]||o;return n?a.a.createElement(d,i(i({ref:t},s),{},{components:n})):a.a.createElement(d,i({ref:t},s))}));function d(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,c=new Array(o);c[0]=h;var i={};for(var l in t)hasOwnProperty.call(t,l)&&(i[l]=t[l]);i.originalType=e,i.mdxType="string"==typeof e?e:r,c[1]=i;for(var s=2;s<o;s++)c[s]=n[s];return a.a.createElement.apply(null,c)}return a.a.createElement.apply(null,n)}h.displayName="MDXCreateElement"}}]);